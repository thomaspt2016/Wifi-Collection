{% extends 'owner/ownhom.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
<title>Add Internet Plan</title>
{% endblock %}

{% block content %}
<div class="flex flex-col flex-grow bg-gray-100 dark:bg-gray-800">

  {# Top Row/Section: The form for adding internet plans #}
  <section class="bg-gray-100 dark:bg-gray-800 flex-grow py-0 px-4 flex items-center justify-center">
    {# Moved container and centering classes to this div #}
    <div class="container mx-auto px-4 py-6 flex-grow flex flex-col h-full w-full max-w-screen-xl items-stretch justify-center">

      <form class="w-full p-5 rounded-lg shadow-lg mb-4 md:mb-0
                   bg-white dark:bg-gray-700 text-blue-800 dark:text-blue-200 flex flex-col justify-center items-center"
            id="internetPlanForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {# Heading for the form #}
        <h2 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white text-center w-full">Add New Internet Plan</h2>

        {# All input fields and the button in a single row for medium and larger screens #}
        <div class="flex flex-col md:flex-row md:gap-4 w-full items-end">
          {# Plan Name Field #}
          <div class="relative z-0 w-full mb-5 group md:w-1/4">
            {% render_field form.plan_name type="text" name="plan_name" id="floating_plan_name" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:focus:border-blue-600 peer" placeholder=" " required="required" %}
            <label for="floating_plan_name" class="peer-focus:font-medium absolute text-sm text-blue-600 dark:text-blue-300 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Plan Name</label>
            {% if form.plan_name.errors %}
            <ul class="text-red-300 text-xs mt-1">
              {% for error in form.plan_name.errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>

          {# Plan Price Field #}
          <div class="relative z-0 w-full mb-5 group md:w-1/4">
            {% render_field form.plan_price type="number" name="plan_price" id="floating_plan_price" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:focus:border-blue-600 peer" placeholder=" " required="required" %}
            <label for="floating_plan_price" class="peer-focus:font-medium absolute text-sm text-blue-600 dark:text-blue-300 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Plan Price</label>
            {% if form.plan_price.errors %}
            <ul class="text-red-300 text-xs mt-1">
              {% for error in form.plan_price.errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>

          {# Plan Type Field (Dropdown) #}
          <div class="relative z-0 w-full mb-5 group md:w-1/4">
            {% render_field form.plan_type name="plan_type" id="floating_plan_type" class="block py-2.5 px-0 w-full text-sm text-blue-800 dark:text-green-500 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" required="required" %}
            <label for="floating_plan_type" class="peer-focus:font-medium absolute text-sm text-blue-600 dark:text-blue-300 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Plan Type</label>
            {% if form.plan_type.errors %}
            <ul class="text-red-300 text-xs mt-1">
              {% for error in form.plan_type.errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>

          {# Number of Devices Field #}
          <div class="relative z-0 w-full mb-5 group md:w-1/4">
            {% render_field form.Num_Devices type="number" name="Num_Devices" id="floating_num_devices" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " required="required" %}
            <label for="floating_num_devices" class="peer-focus:font-medium absolute text-sm text-blue-600 dark:text-blue-300 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Number of Devices</label>
            {% if form.Num_Devices.errors %}
            <ul class="text-red-300 text-xs mt-1">
              {% for error in form.Num_Devices.errors %}
              <li>{{ error }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>

          {# "Add Plan" button moved into the same row #}
          <div class="w-full mb-5 group md:w-1/4 flex justify-center md:justify-start items-center">
            <button type="submit"
              class="text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-900">
              Add Plan
            </button>
          </div>
        </div> {# End of flex container for fields and button #}
      </form>
    </div>
  </section>

  {# Bottom Row/Section: Messages #}
  {% if messages %}
  <section class="py-4 px-4 flex justify-center">
    <div class="container mx-auto px-4 w-full max-w-screen-xl">
      <div class="mt-4 mx-auto max-w-md px-4 sm:px-0 w-full">
        {% for message in messages %}
        <div role="alert"
          class="message-fade mb-3 p-3 rounded-md text-sm font-medium opacity-100 transition-opacity duration-500 ease-in-out
                       {% if message.tags == 'success' %}
                           bg-green-100 text-green-800 border border-green-200
                       {% elif message.tags == 'error' %}
                           bg-red-100 text-red-800 border border-red-200
                       {% elif message.tags == 'info' %}
                           bg-blue-100 text-blue-800 border border-blue-200
                       {% elif message.tags == 'warning' %}
                           bg-yellow-100 text-yellow-800 border border-yellow-200
                       {% else %}
                           bg-gray-100 text-gray-800 border border-gray-200
                       {% endif %}"
          data-fade-delay="{% if message.tags == 'success' %}1000{% else %}2000{% endif %}">
          {{ message }}
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

  {# New Section for displaying all plans in a table #}
  <section class="bg-gray-100 dark:bg-gray-800 py-0 px-4 flex items-center justify-center">
    <div class="container mx-auto px-4 py-6 w-full max-w-screen-xl">
      <div class="bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6">
        <h2 class="mb-4 text-3xl font-extrabold text-gray-900 dark:text-white text-center">Available Internet Plans</h2>
        {% if all_plans %}
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 rounded-lg overflow-hidden">
            <thead class="bg-gray-50 dark:bg-gray-800">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  Plan Name
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  Price
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  Type
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  Devices
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  No Users
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
              {% for plan in all_plans %}
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                  {{ plan.plan_name }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                  QAR{{ plan.plan_price }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                  {{ plan.get_plan_type_display }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                  {{ plan.Num_Devices }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                  {{ plan.No_Users}}
                </td>
                <td class="px-6 py-4">
                  <a href="" class="inline-block text-blue-600 dark:text-blue-500 hover:underline me-3">
                    <img class="w-5 h-5" src="{% static 'owner icos/client/edit-alt.svg' %}" alt="Edit icon" />
                  </a>
                  {% if plan.planstatus %}
                    <a href="" class="inline-block text-blue-600 dark:text-blue-500 hover:underline me-3">
                        <img class="w-5 h-5" src="{% static 'owner icos/client/pause-button.svg' %}" alt="Pause Plan"/>
                    </a>
                {% else %}
                    <a href="" class="inline-block text-blue-600 dark:text-blue-500 hover:underline me-3">
                        <img class="w-5 h-5" src="{% static 'owner icos/client/play-button.svg' %}" alt="Activate Plan"/>
                    </a>
                {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-center text-gray-600 dark:text-gray-400 mt-4">No internet plans available yet.</p>
        {% endif %}
      </div>
    </div>
  </section>

</div>

<script>
  // This script is for the fading messages.
  document.addEventListener('DOMContentLoaded', function () {
    const messages = document.querySelectorAll('.message-fade');

    messages.forEach(message => {
      const delay = parseInt(message.dataset.fadeDelay, 10); // Get delay from data attribute

      setTimeout(() => {
        message.classList.add('opacity-0'); // Start the fade-out transition
        // Remove the element from the DOM after the transition completes
        message.addEventListener('transitionend', () => {
          message.remove();
        }, { once: true }); // Ensure the event listener is only called once
      }, 1000);
    });
  });
</script>
{% endblock %}
